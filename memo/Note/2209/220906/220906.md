지금까지는 모든 GET, POST 요청들을 모두 수용하고 있는데 

이러한 요청 중에서는 비정상적인 혹은 악의적인 요청이 있을 수 있다는 것을 생각해야한다.

그래서 입력한 데이터가 우리가 원하는 데이터 형식이 맞는지에 대한 유효성 검증이 필요한데

Django Form 은 이 과정에서 과중한 작업과 반복 코드를 줄여줌으로써 훨씬 쉽게 유효성 검증을 진행 할 수 있도록 해준다.

그래서 Django Form 는 외부의 악의적 공격 및 데이터 손상에 대한 중요한 방어 수단이며, 

유효성 검사를 단순화 하고 자동화 할 수 있는 기능을 제공한다.

<img src="220906.assets/image-20220906090725471.png" alt="image-20220906090725471" style="zoom:50%;" />

---

# The Django Form Class

<img src="220906.assets/image-20220906090851553.png" alt="image-20220906090851553" style="zoom:50%;" />

<img src="220906.assets/image-20220906091014888.png" alt="image-20220906091014888" style="zoom:50%;" />

<img src="220906.assets/image-20220906091507059.png" alt="image-20220906091507059" style="zoom:50%;" />



```python
# 불러오고
from .forms import ArticleForm


# 기존의 new 함수는 아래와 같지만

def new(request):
    return render(request, 'articles/new.html')


# 추가하여 form 추가

def new(request):
    # 현재는 render만 해주고 있기에
    form = ArticleForm()
    context = {
        'form' :form
    }
    return render(request, 'articles/new.html', context)


```



```html
# 이렇게 해주고 해당 new.html 에 가서

# 기존의 new.html 는 아래와 같은데

{% block content %}
  <h1>NEW</h1>
  <form action="{% url 'articles:create' %}" method="POST">
    {% csrf_token %}
    <label for="title">Title: </label>
    <input type="text" name="title" id="title"><b  r>
    <label for="content">Content: </label>
    <textarea name="content" id="content">
    </textarea><br>
    <input type="submit">
  </form>
  <hr>
  <a href="{% url 'articles:index' %}">뒤로가기</a>
{% endblock content %}



# 이제는 좀 더 손 쉽게

{% block content %}
  <h1>NEW</h1>
  <form action="{% url 'articles:create' %}" method="POST">
    {% csrf_token %}
    {{ form }}
    <input type="submit">
  </form>
  <hr>
  <a href="{% url 'articles:index' %}">뒤로가기</a>
{% endblock content %}


```

다만 form 태그를 사용하면 손쉽긴 하지만 서로 붙어서 태그를 넣을 곳이 없게 되는데 

그래서 form 태그를 사용하는 곳에 {{ form.as_p }} 를 사용해주면 p 태그로 감싸주게 된다. 것으로 적용.



속성의 종류는 몇개가 있지만 우리는 일단 as_p 를 주로 사용할 예정

<img src="220906.assets/image-20220906092840677.png" alt="image-20220906092840677" style="zoom:50%;" />



이제는 우리가 같은 input text 표현만 사용하게 되는데 

input type 를 바꾸기 위해서는 표현을 바꿔야 하는데 

우선 표현을 바꾸기 위해서는 2가지 방법이 있다. 

<img src="220906.assets/image-20220906093006348.png" alt="image-20220906093006348" style="zoom:50%;" />

widgets 은 form fields 소괄호 내부에 작성하는 형식으로 해야 유효성 검사를 유지할 수 있다.

그래서 원래는 html 파일에서 파일타입을 작성하고 그랬지만 

form 태그를 사용하게 되면 하나의 인스턴스 {{ form }} 을 사용하게 되기 때문에 

타입의 경우 forms.py 에서 작성을 해주게 된다.

---

# Widgets

<img src="220906.assets/image-20220906093433538.png" alt="image-20220906093433538" style="zoom:50%;" />

<img src="220906.assets/image-20220906093512649.png" alt="image-20220906093512649" style="zoom:50%;" />

<img src="220906.assets/image-20220906093525929.png" alt="image-20220906093525929" style="zoom:50%;" />





<img src="220906.assets/image-20220906094615145.png" alt="image-20220906094615145" style="zoom:50%;" />

<img src="220906.assets/image-20220906094626757.png" alt="image-20220906094626757" style="zoom:50%;" />

widgets 는 인풋요소의 표현방법만 바꾸는 것

---

# Django ModelForm

<img src="220906.assets/image-20220906100223711.png" alt="image-20220906100223711" style="zoom:50%;" />

<img src="220906.assets/image-20220906100245881.png" alt="image-20220906100245881" style="zoom:50%;" />



ModelForm 상속

<img src="220906.assets/image-20220906100333167.png" alt="image-20220906100333167" style="zoom:50%;" />





<img src="220906.assets/image-20220906101120790.png" alt="image-20220906101120790" style="zoom:50%;" />

<img src="220906.assets/image-20220906101137319.png" alt="image-20220906101137319" style="zoom:50%;" />

그래서 ModelForm 은 모델을 기반으로 타입을 지정해준다.



<img src="220906.assets/image-20220906101417257.png" alt="image-20220906101417257" style="zoom:50%;" />





<img src="220906.assets/image-20220906101544929.png" alt="image-20220906101544929" style="zoom:50%;" />

호출을 하지 않고 이름만 작성하는 것은?

<img src="220906.assets/image-20220906101610725.png" alt="image-20220906101610725" style="zoom:50%;" />

<img src="220906.assets/image-20220906101746843.png" alt="image-20220906101746843" style="zoom:50%;" />

views.index() 가 아닌  views.index 만 입력했었던 이유는?

view 함수가 필요한 시점에 사용하기 위해서 !

<img src="220906.assets/image-20220906101906510.png" alt="image-20220906101906510" style="zoom:50%;" />

<img src="220906.assets/image-20220906102002557.png" alt="image-20220906102002557" style="zoom:50%;" />

---

# ModelForm with view functions

<img src="220906.assets/image-20220906102535769.png" alt="image-20220906102535769" style="zoom: 25%;" />

<img src="220906.assets/image-20220906102546143.png" alt="image-20220906102546143" style="zoom:50%;" />

모델을 기반으로 form 을 만들었기 때문에 

```python
# 이런 식으로만 해도 된다.
def create(request):
    form = ArticleForm(request.POST)

```

그리고 유효성 검사를 하기 위해서는 아래와 같이 코드를 작성

```python
def create(request):
    form = ArticleForm(request.POST)
    # 저장하기 전에 유효성 검사 및 검증
    # is_valid() 로 유효성 검사 
    if form.is_valid():
        # 유효성 검사를 통과하면 True, 아니면 False
        form.save()
        return redirect('articles:iondex')
    return redirect('articles:new')
```

detail 로 가려면 article.pk 값이 필요하게 되는데

modleform 에서 form.save() 호출하게 되면 생성한 객체를 리턴하게 되는데 

그래서 form.save() 을 article 로 받아서 사용하면 된다.

```python
def create(request):
    form = ArticleForm(request.POST)
    # 저장하기 전에 유효성 검사 및 검증
    if form.is_valid():
        # 유효성 검사를 통과하면 True, 아니면 False
        article = form.save()
        return redirect('articles:detail', article.pk)
    return redirect('articles:new')

```

<img src="220906.assets/image-20220906104749796.png" alt="image-20220906104749796" style="zoom:50%;" />

<img src="220906.assets/image-20220906110152601.png" alt="image-20220906110152601" style="zoom:50%;" />

instance = 를 넣게 되면 수정이 되는 것이고, 넣지 않으면 생성을 하는 것이 된다.

---

그리고 is_valid() 로 부터 Error 가 발생하게 되면  

기존에는 빈 값으로 되어있는 form.errors 는 error 메세지로 채워지게 된다.

<img src="220906.assets/image-20220906111016950.png" alt="image-20220906111016950" style="zoom:50%;" />

<img src="220906.assets/image-20220906111026893.png" alt="image-20220906111026893" style="zoom:50%;" />

<img src="220906.assets/image-20220906111034554.png" alt="image-20220906111034554" style="zoom:50%;" />

* 데이터가 없는 값을 보내는 것은 : required 속성 ( html 속성)
* 에러 값을 보내게 된다면 : django 속성

위와 같은 일은 is_valid() 라는 메서드 하나로 이루어지고 있다.



<img src="220906.assets/image-20220906111406661.png" alt="image-20220906111406661" style="zoom:50%;" />

그리고 수정의 경우  request.POST 와 instance 값을 받아야 한다.

그래서 update는 create 와 거의 유사하고 instance= 만 추가가 된다. 



<img src="220906.assets/image-20220906112707982.png" alt="image-20220906112707982" style="zoom:50%;" />

##### Form 과 ModelForm 의 공통점과 차이

공통점  

- 사용자로부터의 요청

차이점 

- 직접적으로 DB 와 연관이 있을 경우 ModelForm

- DB와 연관이 있지 않을 경우 Form

---

# 위젯을 작성하는 2가지 방법

<img src="220906.assets/image-20220906133259971.png" alt="image-20220906133259971" style="zoom:50%;" />

Meta 데이터 위쪽에 form 의 widgets 을 사용하여 따로 넣어주기.

오른쪽 방식으로 보면 타이틀을 변경하는 것으로 

title = forms.CharField( 안에 모든 요소들을 넣어주기)

괄호 안의 키워드 인자를 확인 하기 위해서는 django form field 를 구글에 작성하여 

core field arguments -> label or widget 을 확인해보면 된다.



placeholder 는 입력 칸을 선택하면 없어지는 글을 의미한다.



추가하여 

<img src="220906.assets/image-20220906134342531.png" alt="image-20220906134342531" style="zoom:50%;" />

여기서 maxlength 는 유효성 검사를 하지 않는데 그 이유로는 widget 이므로 검사를 하지 않는다.

---

# Handling HTTP requests

<img src="220906.assets/image-20220906135530741.png" alt="image-20220906135530741" style="zoom:50%;" />

##### new 와 create view 합치기

![image-20220906135836956](220906.assets/image-20220906135836956.png)

메서드만 구분 할 수 있다면 view 함수를 따로 두지 않고 하나로 합칠 수 있게 된다.

근데 위에처럼 합치게 되었을 때 indentaion 의 경우 context 는 else: 를 빠져나온 뒤에 작동 할 수 있도록 하는데

이유는 if form.is_valid() 를 수행하지 못했을 경우에 처리될 수 있도록 하기 위해 그렇게 한다.

create 로 두개의 view 함수를 합치기

합친 후에는 urls.py 에서도 new 삭제 , 기존의 create.html 또한 삭제 후 기존의 new.html 을 creat.html 로 변경

이후 다른 new 요소를 create 로 변경

![image-20220906140006731](220906.assets/image-20220906140006731.png)

우선 widget 은 나아아아 중에 작성을 하기로 생각하기!





C : post

R : Get

U : put

D : Delete 

추후에 위와 같이 method 를 작성하게 된다.

---

# View decorators

(잠시 python 문법)

<img src="220906.assets/image-20220906145429764.png" alt="image-20220906145429764" style="zoom:50%;" />

---

# Allowed HTTP methods

<img src="220906.assets/image-20220906145512881.png" alt="image-20220906145512881" style="zoom:50%;" />

<img src="220906.assets/image-20220906145722287.png" alt="image-20220906145722287" style="zoom:50%;" />

<img src="220906.assets/image-20220906150404900.png" alt="image-20220906150404900" style="zoom:50%;" />

<img src="220906.assets/image-20220906150410280.png" alt="image-20220906150410280" style="zoom:50%;" />

delete 의 경우 

@require_POST 사용하면 된다.