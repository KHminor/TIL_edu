# 연결 지향형 트랜스포트: TCP

### TCP 연결

##### TCP

- 애플리케이션 프로세스가 데이터를 다른 프로세스에게 보내기 전에, 

  ​	두 프로세스가 서로 '핸드셰이크'를 먼저 해야 하므로 연결지향형 (connection oriented)이다.

- 즉, 데이터 전송을 보장하는 파라미터들을 각자 설정하기 위한 어떤 사전 세그먼트들을 보내야 한다. 

- TCP 연결 설정의 일부로서. 연결의 양단은 TCP 연결과 연관된 많은 TCP 상태 변수를 초기화한다.

  ​	

- 핸드셰이크란?

  -  통신을 하는 브라우저와 웹 서버가 서로 암호화 통신을 시작할 수 있도록

    ​	신분을 확인하고, 필요한 정보를 클라이언트와 서버가 주거니 받거니 하는

    ​	과정이 악수와 비슷하여 붙여진 이름.

  <img src="트랜스포트 계층.assets/image-20221023212350635.png" alt="image-20221023212350635" style="zoom: 33%;" />

  

- TCP '연결'은 회선 교환 네트워크에서와 같은 종단 간의 TDM이나 FDM이 아닌,

  ​	두 통신 종단 시스템의 TCP에 존재하는 상태를 공유하는 논리적인 것이다. 

- TCP 프로토콜은 오직 종단 시스템에서만 동작하고 중간의 네트워크 요소(라우터,링크 계층 스위치)에서는 

  ​	동작하지 않으므로, 중간의 네트워크 요소들은 TCP 연결 상태를 유지하지 않는다. 

- 중간 라우터들은 TCP 연결을 전혀 감지하지 못한다. 즉, 이들은 연결은 보지 못하고 데이터그램만을 본다.

- TCp 연결은 전이중 서비스(full-duplex service)를 제공한다. 

  ​	만약 호스트 A의 프로세스와 호스트 B의 프로세스 사이에 TCP 연결이 있다면, 

  ​	애플리케이션 계층 데이터는 B 에서 A로 흐르는 동시에 A에서 B로 흐를 수 있다. 

  ​	또한 TCP 연결은 항상 단일 송신자 와 단일 수신자 사이의 점대점 (polint-10 poin)이다.

-  다만, 단일 송신 동작으로 한 송신자가 여러 수신자에게 데이터를 전송하는 멀티캐스팅은 TCP에선 불가능하다.

  

  

- 용어 정리:

  - TDM(Time Division Multiplexing: 시분할 다중 통신): 

    - 시간분할된 여러 사용자 타입슬롯을 하나로 결합시키는 다중화 방식.
    - 전송로를 점유하는 시간을 분할하여 한 개의 전송로에 여러 개의 가상 경로를 구성하는 통신 방식

    ​	http://www.ktword.co.kr/test/view/view.php?m_temp1=1287

    

  - FDM(Frequency-division multiplexing: 주파수 분할 다중화):

    - 통신 매체에서 이용 가능한 총 대역폭을 겹치지 않는 일련의 주파수 하부 대역으로

      ​	분리시킨 뒤, 분리된 대역을 각각 개별 신호를 전달하는데 사용하도록 하는 기술.

    - 주파수 분할 다중화를 통해 여러 사용자들이 하나의 물리적인 통신 채널을 공유하는 

      ​	경우에는 이를 [주파수 분할 다중 접속](https://ko.wikipedia.org/wiki/주파수_분할_다중_접속)(FDMA)으로 부른다.

    

  - 데이터그램:

    - 패킷교환에서 각각 독립적으로 취급되는 각각의 패킷을 말한다.

      <img src="트랜스포트 계층.assets/image-20221023214156367.png" alt="image-20221023214156367" style="zoom:50%;" />

    

  - 패킷:

    - 정보 기술에서 패킷 방식의 컴퓨터 네트워크가 전달하는 데이터의 형식화된 블록.
    - 즉, 컴퓨터 네트워크에서 데이터를 주고받을 때 정해 놓은 규칙
    - 조금 더 쉬운 이해:
      - 패킷을 pack과 bucket의 합친 말로
      - 우체국에서는 화물을 적당한 덩어리로 나누어 행선지를 표시하는 꼬리표를 붙이는데, 이러한 방식을 데이터 통신에 접목한 것.
      - 즉 정보를 보낼 때 특정 형태를 맞추어 보낸다는 것.
      - 컴퓨터 간에 데이터를 주고 받을 떄 네트워크를 통해서 전송되는 데이터 조각.

  

---

### TCP 세그먼트 구조

##### TCP 세그먼트

- TCP 세그먼트는 헤더 필드와 데이터 필드로 구성되어 있다. (데이터 필드는 애플리케이션 데이터의 일정량을 담는다.)

- MSS(Maximum Segment Size:최대 세그먼트 크기)는 세그먼트의 데이터 필드의 크기를 제한한다.

- TCP가 웹 문서의 이미지와 같은 큰 파일을 전송할 때, 일반적으로 MSS크기로 파일을 분절한다(통상 MSS보다 작은 마지막 분절은 제외). 

- 그러나 많은 대화식 애플리케이 션은 MSS보다 작은 양의 데이터를 전송한다. 

- UDP처럼 헤더는 상위 계층 애플리케이션으로부터 다중화와 역다중화를 하는데 사용하는 출발지와 목적지 포트 번호(source and destination port number)를 포함한다. 

- 또한 UDP처럼 헤더는 체크섬 필드(checksum Field)를 포함한다.

  

​				<img src="트랜스포트 계층.assets/image-20221023215659477.png" alt="image-20221023215659477" style="zoom:50%;" />

- 위 사진은 TCP 세그먼트 구조이다.

- 우선 확인 응답 번호는 신뢰적인 데이터 전송 서비스 구현에서 TCP 송신자와 수신자에 의해 사용된다.

- 16비트 윈도 크기 필드는 흐름 제어에 사용되며 수신자가 받아들이려는 바이트의 크기를 나타내는데 사용된다.

- 4비트 헤더 길이 필드는 32비트 워드 단위로 TCP 헤더의 길이를 나타내며, TCP 헤더는 TCP 옵션 필드 때문에 가변적인 길이가 될 수 있다.

-  옵션 필드는 선택적이고 가변적인 길이로 송신자와 수신자가 최대 세그먼트 크기(MSS)를 협상하거나,

  ​	고속 네트워크에서 사용하기 위한 윈도 확장 요소로 이용되며, 타임스탬프 옵션 또한 정의된다.

- URG 비트는 해당 세그먼트에서 송신 측 상위 계층 개체가 긴급으로 표시하는 데이터임을 가리킨다.

  ​	긴급 데이터의 마지막 바이트의 위치는 16비트의 긴급 데이터 포인터 필드에 의해 가리켜진다.

  ​	TCP는 긴급 데이터가 존재할 때 수신 측 상위 계층 개체에게 통지해야 하고,

  ​	긴급 데이터의 끝에 대한 포인터를 전달한다.

- ACK 비트는 확인응답 필드에 있는 값이 유용함을 가리키는데 사용된다.

- PSH 비트가 설정될 때, 수신자가 데이터를 상위 계층에 즉시 전달해야 한다는 것을 가리킨다.

- RST,SYN,FIN 비트는 연결 설정과 해제에 사용된다.

